{% for grouper, list in model.cost_inputs|groupby('bundle') %}

<div class="card shadow-sm mb-3 chartcanvas">
    <div class="card-header cost_input_header">
        <p class="lead mb-0">Costs</p>
    </div>
    <div class="card-body">

        {% for cost_input in list %}

                    <div class="container mb-2 py-1 rounded border">
                        <p class="mr-4 font-weight-bold">{{ cost_input.name }}</p>

                        <div class="form-inline" id="inputs">
                            <span class="mr-2">Value</span>
                            <input type="range" id="cost_input_static_{{ cost_input.id }}"
                                min={{ cost_input.static_values.value_min }} max={{ cost_input.static_values.value_max }}
                                value={{ cost_input.static_values.value_default }} step={{ cost_input.static_values.step }}
                                class="form-control w-25" 
                                oninput="cost_value_display_{{ cost_input.id }}()"
                                onmouseup="update_costs({{ model.time_horizon }})" 
                                onmouseout="clearview_cost_inputs_{{ cost_input.id }}()"/>
                            <span class="badge badge-pill badge-primary ml-2"><output
                                    id="cost_output_int_static_{{ cost_input.id }}" type="int" 
                                    onmouseover="viewchange(this.id, 'cost_change_int_static_{{ cost_input.id }}', {{ cost_input.static_values.value_default }})"
                                    onmouseout="clearview_cost_inputs_{{ cost_input.id }}()"/></span>
                            <small class="text-muted ml-2"><em id="cost_change_int_static_{{ cost_input.id }}"></em></small>
                            <button type="button" id="reset_button_cost_input_{{ cost_input.id }}" class="btn btn-sm btn-outline-secondary ml-auto"
                                onclick="reset_cost_output_int_{{ cost_input.id }}()">Reset</button>
                        </div>

                        {% if cost_input.input_type != 'static' %}
                            <div class="form-inline">
                                <span class="mr-2">Growth Factor</span>
                                <input type="range" min={{ cost_input.growth_factor.value_min }}
                                    max={{ cost_input.growth_factor.value_max }}
                                    value={{ cost_input.growth_factor.value_default }} step={{ cost_input.growth_factor.step }}
                                    id="cost_input_growth_{{ cost_input.id }}" class="form-control w-25"
                                    oninput="cost_value_display_{{ cost_input.id }}()"
                                    onmouseup="update_costs({{ model.time_horizon }})"/>
                                <span class="badge badge-pill badge-primary ml-2"><output
                                        id="cost_output_int_growth_{{ cost_input.id }}" type="int" 
                                        onmouseover="viewchange(this.id, 'cost_change_int_growth_{{ cost_input.id }}', {{ cost_input.growth_factor.value_default }})"
                                        onmouseout="clearview_cost_inputs_{{ cost_input.id }}()"/></span>
                                <small class="text-muted ml-2"><em id="cost_change_int_growth_{{ cost_input.id }}"></em></small>

                            </div>
                        {% endif %}

                    </div>     
                
        {% endfor %} 

        <small class="text-muted" name="slider_tip">You can set the values for these inputs by moving the sliders.</small>

            <div class="text-right">
                <input type="image" class="mr-2" id="icon_chart_costs"
                    src="{{ url_for('static', filename='images/icons/hide2.png')}}" width="30px"
                    onclick="toggle_div_chart_costs()" />
            </div>
            
            <div id="div_chart_costs" style="display:none">
                <canvas id="chart_costs" height="200"></canvas>
            </div>

        <hr>
        <a href="javascript:void(0)" id="information" class="badge badge-light badge-pill float-right"
            data-toggle="popover" title="information" data-content="#"><b>more â†’</b></a>
    </div>
</div>



<script>
    function toggle_div_chart_costs() {
        var chart = document.getElementById("div_chart_costs");
        var icon = document.getElementById("icon_chart_costs");
        if (chart.style.display === "none") {
            chart.style.display = "block";
            icon.src = "{{ url_for('static', filename='images/icons/show.png')}}"
        } else {
            chart.style.display = "none";
            icon.src = "{{ url_for('static', filename='images/icons/hide2.png')}}"
        };
    }
</script>

<script>
    var months = ['January', 'February', 'March', 'April', 'May', 'June', 'July'];
    update_costs({{ model.time_horizon }});

    {% for cost_input in list %}


        function reset_cost_output_int_{{ cost_input.id }}() {
            var input_static = document.getElementById('cost_input_static_{{ cost_input.id }}')
            input_static.value = {{ cost_input.static_values.value_default }};

            {% if cost_input.input_type != 'static' %}
                var input_growth = document.getElementById('cost_input_growth_{{ cost_input.id }}')
                input_growth.value = {{ cost_input.growth_factor.value_default }};
            {% endif %}

            update_costs({{ model.time_horizon }})
        };




        function clearview_cost_inputs_{{ cost_input.id }}() {
            var change_static = document.getElementById("cost_change_int_static_{{ cost_input.id }}");
            change_static.innerHTML = "";

            {% if cost_input.input_type != 'static' %}
                var change_growth = document.getElementById("cost_change_int_growth_{{ cost_input.id }}");
                change_growth.innerHTML = "";
            {% endif %}

        };

        function cost_value_display_{{ cost_input.id }}() {
            cost_output_int_static_{{ cost_input.id }}.value = cost_input_static_{{ cost_input.id }}.value;
            {% if cost_input.input_type != 'static' %}
                cost_output_int_growth_{{ cost_input.id }}.value = cost_input_growth_{{ cost_input.id }}.value;
            {% endif %}
            
        };

    {% endfor %}

    function update_costs(T) {
        var ctx_costs = document.getElementById('chart_costs').getContext('2d');
        var borderColors = ['rgb(224, 108, 112)', 'rgb(207,100,103)', '#E8B05A', '#FF7F63']
        var fillColors = ['rgba(224, 108, 112, 0.3)', 'rgba(207,100,103,0.3)', '#E8B05A', '#FF7F63']


        {% for cost_input in list %}
            cost_output_int_static_{{ cost_input.id }}.value = cost_input_static_{{ cost_input.id }}.value;
            window.array_static_cost_{{ cost_input.id }}_new = new Array(T).fill(cost_input_static_{{ cost_input.id }}.value);
            {% if cost_input.input_type != 'static' %}
                cost_output_int_growth_{{ cost_input.id }}.value = cost_input_growth_{{ cost_input.id }}.value;
            {% endif %}
            {% if cost_input.input_type == 'linear' %}
                window.array_linear_cost_{{ cost_input.id }}_new = window.array_static_cost_{{ cost_input.id }}_new.map((value, index) => (Math.round((value * 1 + cost_input_growth_{{ cost_input.id }}.value * index) * 100) / 100));
            {% elif cost_input.input_type == 'exp' %}
                window.array_exp_cost_{{ cost_input.id }}_new = window.array_static_cost_{{ cost_input.id }}_new.map((value, index) => (Math.round((value * ((1 + 1*cost_input_growth_{{ cost_input.id }}.value) ** index) + Number.EPSILON) * 100) / 100));
            {% endif %}
        {% endfor %}

        var chart_costs_{{ grouper }} = new Chart(ctx_costs, {
            type: 'line',
            data: {
                labels: months,
                datasets: [

                {% for cost_input in list %}  
                
                    {
                    label: '{{ cost_input.name }}',
                    borderColor: borderColors[parseInt({{ cost_input.id }})-1],
                    backgroundColor: fillColors[parseInt({{ cost_input.id }}) -1],
                    fillOpacity: .3,

                    data: 
                        {% if cost_input.input_type == 'static' %}
                            window.array_static_cost_{{ cost_input.id }}_new,
                        {% elif cost_input.input_type == 'linear' %}
                            window.array_linear_cost_{{ cost_input.id }}_new,
                        {% elif cost_input.input_type == 'exp' %}
                            window.array_exp_cost_{{ cost_input.id }}_new,
                        {% endif %}

                    fill:true,
                    pointRadius: 0
                    },

                {% endfor %}
                ]
            },
            options: {
            legend: {
                position: "bottom",
            },
            scales: {
                yAxes: [{
                    stacked: true,
                    ticks: {
                            maxTicksLimit: 10,
                            }
                        }]
                    }
                }
            });


        chart_costs_{{ grouper }}.update();
        };


</script>

{% endfor %}